<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>주소 검색</title>
</head>
<body onload="init();">
    <form id="form" name="form" method="post">
        <input type="hidden" id="confmKey" name="confmKey" value=""/>
        <input type="hidden" id="returnUrl" name="returnUrl" value=""/>
        <input type="hidden" id="resultType" name="resultType" value="4"/>
    </form>

    <script>
    function getFormValue(name) {
        const form = document.getElementById('form');
        const input = form.elements[name];
        return input ? input.value : '';
    }

    function init() {
        var url = location.href;
        var confmKey = "{{ JUSO_API_KEY }}";
        var resultType = "4"; // 도로명+지번+상세보기(관련지번, 관할주민센터, 상세건물명)

        // 디버깅: API 키 확인
        console.log("JUSO API KEY:", confmKey);

        // POST로 받은 데이터가 있는지 확인
        {% if request.method == 'POST' %}
        var inputYn = "{{ inputYn }}";
        {% else %}
        var inputYn = "";
        {% endif %}

        if (inputYn !== "Y") {
            // 주소 검색 API 호출
            document.form.confmKey.value = confmKey;
            document.form.returnUrl.value = url;
            document.form.resultType.value = resultType;
            document.form.action = "https://business.juso.go.kr/addrlink/addrLinkUrl.do";
            document.form.submit();
        } else {
            // 주소 선택 완료 - 부모 창으로 데이터 전달
            opener.jusoCallBack(
                "{{ roadFullAddr }}",
                "{{ roadAddrPart1 }}",
                "{{ addrDetail }}",
                "{{ roadAddrPart2 }}",
                "{{ engAddr }}",
                "{{ jibunAddr }}",
                "{{ zipNo }}",
                "{{ admCd }}",
                "{{ rnMgtSn }}",
                "{{ bdMgtSn }}",
                "{{ detBdNmList }}",
                "{{ bdNm }}",
                "{{ bdKdcd }}",
                "{{ siNm }}",
                "{{ sggNm }}",
                "{{ emdNm }}",
                "{{ liNm }}",
                "{{ rn }}",
                "{{ udrtYn }}",
                "{{ buldMnnm }}",
                "{{ buldSlno }}",
                "{{ mtYn }}",
                "{{ lnbrMnnm }}",
                "{{ lnbrSlno }}",
                "{{ emdNo }}"
            );
            window.close();
        }
    }
    </script>
</body>
</html>

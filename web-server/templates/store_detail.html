{% extends "base.html" %}

{% block title %}ë§¤ì¥ ìƒì„¸ë³´ê¸° - {{ store_id }}{% endblock %}

{% block content %}
<div class="store-detail-container">
    <!-- ë¡œë”© ìƒíƒœ -->
    <div id="loading" class="loading-container">
        <div class="spinner"></div>
        <p>ë§¤ì¥ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>

    <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
    <div id="error" class="error-container" style="display: none;">
        <div class="error-icon">âš ï¸</div>
        <h3>ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</h3>
        <p id="error-message"></p>
        <button onclick="location.href='/dashboard'" class="btn-back">ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</button>
    </div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <div id="main-content" style="display: none;">
        <!-- í—¤ë” -->
        <div class="detail-header">
            <a href="/dashboard" class="back-link">â† ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a>
            <h1 id="store-name">ë§¤ì¥ ìƒì„¸ë³´ê¸°</h1>
            <p id="store-address" class="store-address"></p>
        </div>

        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('info')">ë§¤ì¥ ì •ë³´</button>
            <button class="tab-button" onclick="showTab('menus')">ë©”ë‰´</button>
            <button class="tab-button" onclick="showTab('reviews')">ë¦¬ë·°</button>
            <button class="tab-button" onclick="showTab('summary')">ìš”ì•½</button>
            <button class="tab-button" onclick="showTab('rag-docs')">RAG ë¬¸ì„œ</button>
        </div>

        <!-- ë§¤ì¥ ì •ë³´ íƒ­ -->
        <div id="tab-info" class="tab-content active">
            <div class="info-grid">
                <div class="info-card">
                    <h3>ê¸°ë³¸ ì •ë³´</h3>
                    <div class="info-row">
                        <span class="info-label">ë§¤ì¥ëª…:</span>
                        <span id="info-store-name"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ì£¼ì†Œ:</span>
                        <span id="info-address"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ì „í™”ë²ˆí˜¸:</span>
                        <span id="info-phone"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ì¹´í…Œê³ ë¦¬:</span>
                        <span id="info-category"></span>
                    </div>
                </div>

                <div class="info-card">
                    <h3>ë“±ë¡ ì •ë³´</h3>
                    <div class="info-row">
                        <span class="info-label">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸:</span>
                        <span id="info-business-number"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ëŒ€í‘œìëª…:</span>
                        <span id="info-owner-name"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ëŒ€í‘œì ì—°ë½ì²˜:</span>
                        <span id="info-owner-phone"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ìŠ¤í¬ë˜í•‘ ìƒíƒœ:</span>
                        <span id="info-status"></span>
                    </div>
                </div>

                <div class="info-card full-width" id="intro-card" style="display: none;">
                    <h3>ë§¤ì¥ ì†Œê°œ</h3>
                    <p id="info-intro"></p>
                </div>

                <div class="info-card full-width" id="description-card" style="display: none;">
                    <h3>ìƒì„¸ ì„¤ëª…</h3>
                    <p id="info-description"></p>
                </div>

                <div class="info-card full-width" id="services-card" style="display: none;">
                    <h3>ì œê³µ ì„œë¹„ìŠ¤</h3>
                    <p id="info-services"></p>
                </div>
            </div>
        </div>

        <!-- ë©”ë‰´ íƒ­ -->
        <div id="tab-menus" class="tab-content">
            <div class="section-header">
                <h2>ë©”ë‰´ ëª©ë¡</h2>
                <span id="menu-count" class="count-badge"></span>
            </div>
            <div id="menus-grid" class="menus-grid"></div>
            <div id="no-menus" class="empty-state" style="display: none;">
                <p>ë“±ë¡ëœ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </div>

        <!-- ë¦¬ë·° íƒ­ -->
        <div id="tab-reviews" class="tab-content">
            <div class="section-header">
                <h2>ê³ ê° ë¦¬ë·°</h2>
                <span id="review-count" class="count-badge"></span>
            </div>
            <div id="reviews-list" class="reviews-list"></div>
            <div id="no-reviews" class="empty-state" style="display: none;">
                <p>ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </div>

        <!-- ìš”ì•½ íƒ­ -->
        <div id="tab-summary" class="tab-content">
            <div class="section-header">
                <h2>AI ë¦¬ë·° ë¶„ì„ ìš”ì•½</h2>
                <button onclick="window.location.href='/store/'+storeId+'/summary'" class="btn-full-summary">
                    ì „ì²´ ìš”ì•½ í˜ì´ì§€ ë³´ê¸°
                </button>
            </div>
            <div id="summary-content" class="summary-preview"></div>
            <div id="no-summary" class="empty-state" style="display: none;">
                <p>ìš”ì•½ì´ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
            </div>
        </div>

        <!-- RAG ë¬¸ì„œ íƒ­ -->
        <div id="tab-rag-docs" class="tab-content">
            <div class="section-header">
                <h2>RAG ì±—ë´‡ í™œìš© ë¬¸ì„œ</h2>
                <button onclick="refreshRagDocs()" class="btn-refresh" id="refresh-btn">
                    ğŸ”„ ìƒˆë¡œê³ ì¹¨
                </button>
            </div>
            <div class="rag-docs-container">
                <div class="rag-doc-card">
                    <h3>ğŸ“„ ë§¤ì¥ ì •ë³´ ë¬¸ì„œ</h3>
                    <div id="rag-doc-store-info" class="rag-doc-content">
                        <div class="loading-text">ë¬¸ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    </div>
                </div>
                <div class="rag-doc-card">
                    <h3>ğŸ½ï¸ ë©”ë‰´ ì •ë³´ ë¬¸ì„œ</h3>
                    <div id="rag-doc-menus" class="rag-doc-content">
                        <div class="loading-text">ë¬¸ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    </div>
                </div>
                <div class="rag-doc-card">
                    <h3>ğŸ’¬ ë¦¬ë·° ìš”ì•½ ë¬¸ì„œ</h3>
                    <div id="rag-doc-reviews" class="rag-doc-content">
                        <div class="loading-text">ë¬¸ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    </div>
                </div>
            </div>
            <div id="no-rag-docs" class="empty-state" style="display: none;">
                <p>RAG ë¬¸ì„œê°€ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
                <button onclick="generateRagDocs()" class="btn-generate">ë¬¸ì„œ ìƒì„±í•˜ê¸°</button>
            </div>
        </div>
    </div>
</div>

<style>
.store-detail-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.loading-container {
    text-align: center;
    padding: 80px 20px;
}

.spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #0066cc;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.error-container {
    text-align: center;
    padding: 60px 20px;
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
}

.error-icon {
    font-size: 48px;
    margin-bottom: 20px;
}

.btn-back {
    background: #0066cc;
    color: white;
    border: none;
    padding: 10px 24px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    margin-top: 20px;
}

.detail-header {
    margin-bottom: 30px;
}

.back-link {
    display: inline-block;
    color: #0066cc;
    text-decoration: none;
    margin-bottom: 20px;
    font-weight: 500;
}

.back-link:hover {
    text-decoration: underline;
}

.detail-header h1 {
    font-size: 32px;
    color: #1a1a1a;
    margin-bottom: 10px;
}

.store-address {
    color: #666;
    font-size: 16px;
}

.tabs {
    display: flex;
    gap: 10px;
    border-bottom: 2px solid #e1e4e8;
    margin-bottom: 30px;
}

.tab-button {
    background: none;
    border: none;
    padding: 12px 24px;
    font-size: 16px;
    font-weight: 500;
    color: #666;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.2s;
}

.tab-button:hover {
    color: #0066cc;
}

.tab-button.active {
    color: #0066cc;
    border-bottom-color: #0066cc;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 20px;
}

.info-card {
    background: white;
    padding: 24px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.info-card.full-width {
    grid-column: 1 / -1;
}

.info-card h3 {
    font-size: 18px;
    color: #1a1a1a;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 2px solid #e1e4e8;
}

.info-row {
    display: flex;
    margin-bottom: 12px;
}

.info-label {
    font-weight: 600;
    color: #555;
    min-width: 140px;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.section-header h2 {
    font-size: 24px;
    color: #1a1a1a;
}

.count-badge {
    background: #0066cc;
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
}

.btn-full-summary {
    background: #28a745;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
}

.btn-full-summary:hover {
    background: #218838;
}

.btn-refresh {
    background: #6c757d;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
}

.btn-refresh:hover {
    background: #5a6268;
}

.btn-generate {
    background: #0066cc;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    margin-top: 16px;
}

.btn-generate:hover {
    background: #0052a3;
}

.rag-docs-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.rag-doc-card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    overflow: hidden;
}

.rag-doc-card h3 {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 16px 20px;
    margin: 0;
    font-size: 18px;
}

.rag-doc-content {
    padding: 20px;
    max-height: 400px;
    overflow-y: auto;
    line-height: 1.6;
    color: #333;
    background: #f8f9fa;
}

.rag-doc-content pre {
    background: white;
    padding: 12px;
    border-radius: 4px;
    border-left: 4px solid #667eea;
    overflow-x: auto;
}

.rag-doc-content h1, .rag-doc-content h2, .rag-doc-content h3 {
    color: #1a1a1a;
    margin-top: 16px;
    margin-bottom: 8px;
}

.loading-text {
    text-align: center;
    color: #666;
    padding: 40px 20px;
}

.error-text {
    text-align: center;
    color: #dc3545;
    padding: 40px 20px;
}

.menus-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
}

.menu-card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    overflow: hidden;
    transition: transform 0.2s;
}

.menu-card:hover {
    transform: translateY(-4px);
}

.menu-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
    background: #f0f0f0;
}

.menu-info {
    padding: 16px;
}

.menu-name {
    font-size: 16px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 8px;
}

.menu-price {
    font-size: 18px;
    color: #0066cc;
    font-weight: 700;
}

.menu-description {
    font-size: 14px;
    color: #666;
    margin-top: 8px;
    line-height: 1.4;
}

.reviews-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.review-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.review-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.review-author {
    font-weight: 600;
    color: #1a1a1a;
}

.review-date {
    font-size: 14px;
    color: #666;
}

.review-rating {
    color: #ffa500;
    margin-bottom: 8px;
}

.review-text {
    color: #333;
    line-height: 1.6;
}

.review-menu {
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px solid #e1e4e8;
    font-size: 14px;
    color: #0066cc;
}

.summary-preview {
    background: white;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    max-height: 600px;
    overflow-y: auto;
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #666;
    background: #f8f9fa;
    border-radius: 8px;
}

@media (max-width: 768px) {
    .info-grid {
        grid-template-columns: 1fr;
    }

    .menus-grid {
        grid-template-columns: 1fr;
    }

    .tabs {
        overflow-x: auto;
    }
}
</style>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
const storeId = {{ store_id }};
let storeData = null;

let ragDocsLoaded = false;

document.addEventListener('DOMContentLoaded', function() {
    loadStoreDetail();
});

async function loadStoreDetail() {
    try {
        const response = await fetch(`/api/stores/${storeId}/detail`);

        if (!response.ok) {
            throw new Error('ë§¤ì¥ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }

        storeData = await response.json();

        document.getElementById('loading').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';

        displayStoreInfo(storeData.store_info);
        displayMenus(storeData.menus);
        displayReviews(storeData.reviews);
        displaySummary(storeData.summary, storeData.summary_status);

    } catch (error) {
        console.error('Error:', error);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error-message').textContent = error.message;
        document.getElementById('error').style.display = 'block';
    }
}

function displayStoreInfo(info) {
    // í—¤ë”
    document.getElementById('store-name').textContent = info.scraped_store_name || info.store_name;
    document.getElementById('store-address').textContent = info.scraped_store_address || info.store_address;

    // ê¸°ë³¸ ì •ë³´
    document.getElementById('info-store-name').textContent = info.scraped_store_name || info.store_name;
    document.getElementById('info-address').textContent = info.scraped_store_address || info.store_address;
    document.getElementById('info-phone').textContent = info.scraped_phone || '-';
    document.getElementById('info-category').textContent = info.scraped_category || '-';

    // ë“±ë¡ ì •ë³´
    document.getElementById('info-business-number').textContent = info.business_number;
    document.getElementById('info-owner-name').textContent = info.owner_name;
    document.getElementById('info-owner-phone').textContent = info.owner_phone;
    document.getElementById('info-status').innerHTML = getStatusBadge(info.scraping_status);

    // ì„ íƒì  ì •ë³´
    if (info.scraped_intro) {
        document.getElementById('intro-card').style.display = 'block';
        document.getElementById('info-intro').textContent = info.scraped_intro;
    }

    if (info.scraped_description) {
        document.getElementById('description-card').style.display = 'block';
        document.getElementById('info-description').textContent = info.scraped_description;
    }

    if (info.scraped_services) {
        document.getElementById('services-card').style.display = 'block';
        document.getElementById('info-services').textContent = info.scraped_services;
    }
}

function displayMenus(menus) {
    const menusGrid = document.getElementById('menus-grid');
    const noMenus = document.getElementById('no-menus');
    const menuCount = document.getElementById('menu-count');

    menuCount.textContent = `${menus.length}ê°œ`;

    if (menus.length === 0) {
        menusGrid.style.display = 'none';
        noMenus.style.display = 'block';
        return;
    }

    menusGrid.innerHTML = menus.map(menu => `
        <div class="menu-card">
            ${menu.image_url ? `<img src="${menu.image_url}" alt="${menu.menu_name}" class="menu-image" onerror="this.style.display='none'">` : '<div class="menu-image"></div>'}
            <div class="menu-info">
                <div class="menu-name">${menu.menu_name}</div>
                <div class="menu-price">${formatPrice(menu.price)}</div>
                ${menu.description ? `<div class="menu-description">${menu.description}</div>` : ''}
            </div>
        </div>
    `).join('');
}

function displayReviews(reviews) {
    const reviewsList = document.getElementById('reviews-list');
    const noReviews = document.getElementById('no-reviews');
    const reviewCount = document.getElementById('review-count');

    reviewCount.textContent = `${reviews.length}ê°œ`;

    if (reviews.length === 0) {
        reviewsList.style.display = 'none';
        noReviews.style.display = 'block';
        return;
    }

    reviewsList.innerHTML = reviews.slice(0, 50).map(review => `
        <div class="review-card">
            <div class="review-header">
                <div class="review-author">${review.author || 'ìµëª…'}</div>
                <div class="review-date">${review.visit_date || '-'}</div>
            </div>
            ${review.rating ? `<div class="review-rating">${'â˜…'.repeat(review.rating)}${'â˜†'.repeat(5-review.rating)}</div>` : ''}
            <div class="review-text">${review.content}</div>
            ${review.menu ? `<div class="review-menu">ì£¼ë¬¸ ë©”ë‰´: ${review.menu}</div>` : ''}
        </div>
    `).join('');

    if (reviews.length > 50) {
        reviewsList.innerHTML += `<div class="empty-state">ì²˜ìŒ 50ê°œì˜ ë¦¬ë·°ë§Œ í‘œì‹œë©ë‹ˆë‹¤. (ì „ì²´ ${reviews.length}ê°œ)</div>`;
    }
}

function displaySummary(summary, status) {
    const summaryContent = document.getElementById('summary-content');
    const noSummary = document.getElementById('no-summary');

    if (status === 'completed' && summary) {
        summaryContent.innerHTML = marked.parse(summary);
        summaryContent.style.display = 'block';
        noSummary.style.display = 'none';
    } else {
        summaryContent.style.display = 'none';
        noSummary.style.display = 'block';
    }
}

function showTab(tabName) {
    // ëª¨ë“  íƒ­ ë²„íŠ¼ê³¼ ì½˜í…ì¸  ë¹„í™œì„±í™”
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

    // ì„ íƒëœ íƒ­ í™œì„±í™”
    event.target.classList.add('active');
    document.getElementById(`tab-${tabName}`).classList.add('active');

    // RAG ë¬¸ì„œ íƒ­ì´ë©´ ë¬¸ì„œ ë¡œë“œ
    if (tabName === 'rag-docs' && !ragDocsLoaded) {
        loadRagDocs();
    }
}

async function loadRagDocs() {
    try {
        const response = await fetch(`/api/stores/${storeId}/rag-documents`);

        if (!response.ok) {
            throw new Error('RAG ë¬¸ì„œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }

        const data = await response.json();

        if (data.documents && data.documents.length > 0) {
            displayRagDoc('store-info', data.documents.find(d => d.type === 'store_info'));
            displayRagDoc('menus', data.documents.find(d => d.type === 'menu_info'));
            displayRagDoc('reviews', data.documents.find(d => d.type === 'review_summary'));
            ragDocsLoaded = true;
        } else {
            document.querySelector('.rag-docs-container').style.display = 'none';
            document.getElementById('no-rag-docs').style.display = 'block';
        }
    } catch (error) {
        console.error('Error loading RAG docs:', error);
        displayRagDocError('store-info');
        displayRagDocError('menus');
        displayRagDocError('reviews');
    }
}

function displayRagDoc(docType, docData) {
    const contentDiv = document.getElementById(`rag-doc-${docType}`);

    if (docData && docData.content) {
        contentDiv.innerHTML = marked.parse(docData.content);
    } else {
        contentDiv.innerHTML = '<div class="error-text">ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
    }
}

function displayRagDocError(docType) {
    const contentDiv = document.getElementById(`rag-doc-${docType}`);
    contentDiv.innerHTML = '<div class="error-text">ë¬¸ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
}

async function refreshRagDocs() {
    ragDocsLoaded = false;
    document.getElementById('rag-doc-store-info').innerHTML = '<div class="loading-text">ë¬¸ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
    document.getElementById('rag-doc-menus').innerHTML = '<div class="loading-text">ë¬¸ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
    document.getElementById('rag-doc-reviews').innerHTML = '<div class="loading-text">ë¬¸ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
    await loadRagDocs();
}

async function generateRagDocs() {
    const btn = event.target;
    btn.disabled = true;
    btn.textContent = 'ìƒì„± ì¤‘...';

    try {
        const response = await fetch('http://112.148.37.41:8002/api/generate-documents', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                store_id: storeId
            })
        });

        const data = await response.json();

        if (data.status === 'success') {
            alert('RAG ë¬¸ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
            document.querySelector('.rag-docs-container').style.display = 'flex';
            document.getElementById('no-rag-docs').style.display = 'none';
            await loadRagDocs();
        } else {
            throw new Error(data.message || 'ë¬¸ì„œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    } catch (error) {
        alert('ë¬¸ì„œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
    } finally {
        btn.disabled = false;
        btn.textContent = 'ë¬¸ì„œ ìƒì„±í•˜ê¸°';
    }
}

function getStatusBadge(status) {
    const badges = {
        'pending': '<span style="background: #fef3c7; color: #92400e; padding: 4px 12px; border-radius: 12px; font-size: 14px;">ëŒ€ê¸°ì¤‘</span>',
        'in_progress': '<span style="background: #dbeafe; color: #1e40af; padding: 4px 12px; border-radius: 12px; font-size: 14px;">ì§„í–‰ì¤‘</span>',
        'completed': '<span style="background: #d1fae5; color: #065f46; padding: 4px 12px; border-radius: 12px; font-size: 14px;">ì™„ë£Œ</span>',
        'mismatch': '<span style="background: #fed7aa; color: #9a3412; padding: 4px 12px; border-radius: 12px; font-size: 14px;">ì •ë³´ë¶ˆì¼ì¹˜</span>',
        'error': '<span style="background: #fee2e2; color: #991b1b; padding: 4px 12px; border-radius: 12px; font-size: 14px;">ì˜¤ë¥˜</span>'
    };
    return badges[status] || badges['pending'];
}

function formatPrice(price) {
    if (!price) return '-';
    if (typeof price === 'string') {
        return price;
    }
    return price.toLocaleString('ko-KR') + 'ì›';
}
</script>
{% endblock %}
